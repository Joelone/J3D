<html>

<head>
    <title>024 | Benchmark | J3D</title>

    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">

    <link rel="stylesheet" href="common/common.css"/>
    <script type="text/javascript" src="common/common.js"></script>
    <script type="text/javascript" src="js/Stats.js"></script>

<!-- J3DLIB -->
<!-- Auto-generated by tools/demojstags.py. Do not edit this section -->
<script type="text/javascript" src="../lib/requestAnimationFrame.js"></script>
<script type="text/javascript" src="../src/J3D.js"></script>
<script type="text/javascript" src="../src/SQR.js"></script>
<script type="text/javascript" src="../src/engine/AssetLoader.js"></script>
<script type="text/javascript" src="../src/engine/BuiltinShaders.js"></script>
<script type="text/javascript" src="../src/engine/Camera.js"></script>
<script type="text/javascript" src="../src/engine/Collider.js"></script>
<script type="text/javascript" src="../src/engine/Cubemap.js"></script>
<script type="text/javascript" src="../src/engine/Engine.js"></script>
<script type="text/javascript" src="../src/engine/FrameBuffer.js"></script>
<script type="text/javascript" src="../src/engine/Geometry.js"></script>
<script type="text/javascript" src="../src/engine/Light.js"></script>
<script type="text/javascript" src="../src/engine/Loader.js"></script>
<script type="text/javascript" src="../src/engine/Mesh.js"></script>
<script type="text/javascript" src="../src/engine/Postprocess.js"></script>
<script type="text/javascript" src="../src/engine/Primitives.js"></script>
<script type="text/javascript" src="../src/engine/Ray.js"></script>
<script type="text/javascript" src="../src/engine/Scene.js"></script>
<script type="text/javascript" src="../src/engine/Shader.js"></script>
<script type="text/javascript" src="../src/engine/ShaderAtlas.js"></script>
<script type="text/javascript" src="../src/engine/ShaderSource.js"></script>
<script type="text/javascript" src="../src/engine/Texture.js"></script>
<script type="text/javascript" src="../src/engine/Transform.js"></script>
<script type="text/javascript" src="../src/extras/Capabilities.js"></script>
<script type="text/javascript" src="../src/extras/Interactor.js"></script>
<script type="text/javascript" src="../src/extras/PointerLock.js"></script>
<script type="text/javascript" src="../src/extras/UserStream.js"></script>
<script type="text/javascript" src="../src/legacy-math/Vector2.js"></script>
<script type="text/javascript" src="../src/legacy-math/Vector3.js"></script>
<script type="text/javascript" src="../src/math/Matrix2D.js"></script>
<script type="text/javascript" src="../src/math/Matrix33.js"></script>
<script type="text/javascript" src="../src/math/Matrix44.js"></script>
<script type="text/javascript" src="../src/math/ProjectionMatrix.js"></script>
<script type="text/javascript" src="../src/math/Quaternion.js"></script>
<script type="text/javascript" src="../src/math/Vector2.js"></script>
<script type="text/javascript" src="../src/math/Vector3.js"></script>
<script type="text/javascript" src="../src/math/VectorUtil.js"></script>
<script type="text/javascript" src="../src/util/Color.js"></script>
<script type="text/javascript" src="../src/util/Error.js"></script>
<script type="text/javascript" src="../src/util/GeometryUtil.js"></script>
<script type="text/javascript" src="../src/util/Intersection.js"></script>
<script type="text/javascript" src="../src/util/MathUtil.js"></script>
<script type="text/javascript" src="../src/util/ParticleUtil.js"></script>
<script type="text/javascript" src="../src/util/ShaderUtil.js"></script>
<script type="text/javascript" src="../src/util/Time.js"></script>
<!-- J3DLIB -->

    <script>
        var engine, scene;
        var camroot, root, camera;
        var mx = 0, my = 0;
        var isMouseDown = false;
        var stats;

         window.onload = function() {
            if (!J3D.Capabilities.webgl) return;

            engine = new J3D.Engine(null, null, { antialias: false, alpha: false });
            engine.setClearColor(J3D.Color.white);

            camera = new J3D.Transform();
            camera.camera = new J3D.Camera();
            camera.position.z = 200;
            engine.scene.setCamera(camera);

            camroot = new J3D.Transform();
            camroot.add(camera);
            engine.scene.add(camroot);

            root = new J3D.Transform();

            var cubegeo = J3D.Primitive.Cube(2,2,2);

            var cubemat = J3D.BuiltinShaders.fetch("Normal2Color");

            for(var i = 0; i < 5000; i++) {
                var c = new J3D.Transform();

                c.isStatic = true;

                c.position = v3.random().norm().mul(30 + Math.random() * 70);

                c.rotation.x = Math.random() * Math.PI;
                c.rotation.y = Math.random() * Math.PI;
                c.rotation.z = Math.random() * Math.PI;

                c.geometry = cubegeo;
                c.renderer = cubemat;

                root.add(c);
            }

            engine.scene.add(root);

            document.onmousemove = onMouseMove;

            stats = new Stats();
			document.body.appendChild( stats.domElement );

            draw();
        }

        function onMouseMove(e) {
            mx = ( e.clientX / window.innerWidth  ) * 2 - 1;
            my = ( e.clientY / window.innerHeight ) * 2 - 1;
        }

        function draw() {
            stats.begin();
            camroot.rotation.x += my * J3D.Time.deltaTime / 1000;
            camroot.rotation.y += mx * J3D.Time.deltaTime / 2000;

            engine.render();
            stats.end();
            requestAnimationFrame(draw);
        }

    </script>

</head>

<body>
	<script>
		setLabels("024. Benchmark", "Performance testing with 5K cubes");
	</script>

</body>

</html> 