<html> 
 
<head> 
<title>015 | Persistence | J3D</title>

<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1"> 

<link rel="stylesheet" href="common/common.css"/>
<script type="text/javascript" src="common/common.js"></script>
    
<!-- J3DLIB -->
<!-- Auto-generated by tools/demojstags.py. Do not edit this section -->
<script type="text/javascript" src="../lib/requestAnimationFrame.js"></script>
<script type="text/javascript" src="../src/J3D.js"></script>
<script type="text/javascript" src="../src/SQR.js"></script>
<script type="text/javascript" src="../src/engine/AssetLoader.js"></script>
<script type="text/javascript" src="../src/engine/BuiltinShaders.js"></script>
<script type="text/javascript" src="../src/engine/Camera.js"></script>
<script type="text/javascript" src="../src/engine/Collider.js"></script>
<script type="text/javascript" src="../src/engine/Cubemap.js"></script>
<script type="text/javascript" src="../src/engine/Engine.js"></script>
<script type="text/javascript" src="../src/engine/FrameBuffer.js"></script>
<script type="text/javascript" src="../src/engine/Geometry.js"></script>
<script type="text/javascript" src="../src/engine/Light.js"></script>
<script type="text/javascript" src="../src/engine/Loader.js"></script>
<script type="text/javascript" src="../src/engine/Mesh.js"></script>
<script type="text/javascript" src="../src/engine/Postprocess.js"></script>
<script type="text/javascript" src="../src/engine/Primitives.js"></script>
<script type="text/javascript" src="../src/engine/Ray.js"></script>
<script type="text/javascript" src="../src/engine/Scene.js"></script>
<script type="text/javascript" src="../src/engine/Shader.js"></script>
<script type="text/javascript" src="../src/engine/ShaderAtlas.js"></script>
<script type="text/javascript" src="../src/engine/ShaderSource.js"></script>
<script type="text/javascript" src="../src/engine/Texture.js"></script>
<script type="text/javascript" src="../src/engine/Transform.js"></script>
<script type="text/javascript" src="../src/extras/Capabilities.js"></script>
<script type="text/javascript" src="../src/extras/Interactor.js"></script>
<script type="text/javascript" src="../src/extras/PointerLock.js"></script>
<script type="text/javascript" src="../src/extras/UserStream.js"></script>
<script type="text/javascript" src="../src/legacy-math/Vector2.js"></script>
<script type="text/javascript" src="../src/legacy-math/Vector3.js"></script>
<script type="text/javascript" src="../src/math/Matrix2D.js"></script>
<script type="text/javascript" src="../src/math/Matrix33.js"></script>
<script type="text/javascript" src="../src/math/Matrix44.js"></script>
<script type="text/javascript" src="../src/math/ProjectionMatrix.js"></script>
<script type="text/javascript" src="../src/math/Quaternion.js"></script>
<script type="text/javascript" src="../src/math/Vector2.js"></script>
<script type="text/javascript" src="../src/math/Vector3.js"></script>
<script type="text/javascript" src="../src/math/VectorUtil.js"></script>
<script type="text/javascript" src="../src/util/Color.js"></script>
<script type="text/javascript" src="../src/util/Error.js"></script>
<script type="text/javascript" src="../src/util/GeometryUtil.js"></script>
<script type="text/javascript" src="../src/util/Intersection.js"></script>
<script type="text/javascript" src="../src/util/MathUtil.js"></script>
<script type="text/javascript" src="../src/util/ParticleUtil.js"></script>
<script type="text/javascript" src="../src/util/ShaderUtil.js"></script>
<script type="text/javascript" src="../src/util/Time.js"></script>
<!-- J3DLIB -->

<script type="text/javascript" src="js/PersistenceVideo.js"></script>

<script id="blendFilter" type="x-shader/x-filter">
	//#name BlendFilter
	//#author bartekd
	
	//#include CommonFilterInclude
	
	//#vertex
	//#include BasicFilterVertex
	
	//#fragment
	uniform sampler2D uNewTexture;
	uniform sampler2D uOldTexture;

    uniform float amount;
	
	varying vec2 vTextureCoord;

	void main(void) {
		vec4 n = texture2D(uNewTexture, vTextureCoord);
		vec4 o = texture2D(uOldTexture, vTextureCoord);
		gl_FragColor = vec4(mix(n.rgb, o.rgb, amount), 1.0);
	}
</script>

<script>

	var engine, post;
    var mx = 0, my = 0;
	
	window.onload = function() {
		
		if(!J3D.Capabilities.webgl) return;
		
		engine = new J3D.Engine();	
		engine.setClearColor(J3D.Color.white);

		post = new J3D.Persistence(engine);
        post.vTexture = new J3D.Texture("models/textures/loop.mp4", { loop:"true" });
		post.blendFilter = new J3D.ShaderUtil.parseGLSL(document.getElementById("blendFilter").firstChild.nodeValue);

        document.onmousemove = onMouseMove;

		draw();
	}

    function onMouseMove(e) {
		mx = ( e.clientX / window.innerWidth  );
		my = ( e.clientY / window.innerHeight ) * 2 - 1;
	}
	
	function draw() {
		requestAnimationFrame(draw);
        post.blendFilter.amount = Math.pow(mx, 0.5);
		post.render();
	}
	
</script>

</head> 

<body>
	<script>
		setLabels("025. Video Persistence", "A demo of post processing effect with J3D applied to video");
	</script>

</body> 



</html> 












